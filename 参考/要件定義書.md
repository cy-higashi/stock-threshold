# 在庫しきい値アラート 要件定義書

## 1. 目的

ポータルが指定した最低在庫数未満の商品があった場合、CyberRecords の ChatWork にアラートを出し、担当者がポータル側に連携することで、在庫切れによる販売機会損失を防止する。

## 2. 要件定義


| No. | 要件       | 内容                                                            |
| --- | -------- | ------------------------------------------------------------- |
| 1   | 最低在庫の設定  | ポータルが指定する商品と最低在庫数は、ポータルごとの CSV で設定する。実行のたびに当該ファイルから読み出す。ファイルパスは setting.json の min_stock_base_path で指定する。 |
| 2   | 在庫データの取得 | 引数で渡したディレクトリの CSV / TSV / txt / XLSX を全件取得する。通常はカラム名で商品コード・在庫数を指定する。Choice ポータルは TSV 2 ファイルを第一カラムでジョインする特殊処理を行う。 |
| 3   | アラート通知   | 総在庫数が最低在庫数以下（<=）の場合、ChatWork にアラートを通知する。最低在庫数 CSV に存在しない返礼品コードはスキップする。 |
| 4   | 実行頻度     | 実行頻度は 1 日 1 回を想定する。                                           |
| 5   | ポータル対象の絞り込み | min_stock_base_path が空文字のポータルは処理対象外とする。複数ポータル一括実行時は、対象ポータルのみをアルファベット順でシリアルに処理する。 |
| 6   | 複数ポータル一括実行 | ベースディレクトリ配下に複数のポータル名ディレクトリがある場合、run_all_portals により対象ポータルを 1 つずつ順次処理できる。 |


## 3. 用語


| 用語    | 説明                                                 |
| ----- | -------------------------------------------------- |
| ポータル  | 在庫データの供給元となる各販路・チャネル。ポータルごとに CSV で商品と最低在庫数を設定する。setting.json の min_stock_base_path が空のポータルは処理対象外。 |
| ユーザ   | CSV を操作するポータル側担当者                                  |
| 総在庫数  | 取得した在庫データ（CSV/TSV/XLSX 等）を商品コードで合算した在庫数。                    |
| 最低在庫数 | ポータルが CSV で設定した、当該商品の在庫が下回ってはいけないしきい値。           |


